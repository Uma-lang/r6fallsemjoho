<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-type" content="text/html; charset=Shift_JIS">
    <title>データベース論（岩切准教授）</title>
    <link rel="stylesheet" href="../dbstyle.css">
    <style type="text/css">
    </style>
</head>

<body>


    <h2>
        <height=19 width=18 alt="">
            数値演算と関数
    </h2>

    <h4>(1) <a name="1">算術演算</a></h4>
    <p>
        MySQLでは、基本的な算術演算ができます。ここでは、演算結果を SELECT文により直接表示させています。※ "%"は剰余を求める演算子
    </p>
    <pre class=c>
mysql> select +1, -1, 1+2, 2-3, 3*4, 4/5, 123%4;
+---+----+-----+-----+-----+--------+-------+
| 1 | -1 | 1+2 | 2-3 | 3*4 | 4/5    | 123%4 |
+---+----+-----+-----+-----+--------+-------+
| 1 | -1 |   3 |  -1 |  12 | 0.8000 |     3 |
+---+----+-----+-----+-----+--------+-------+
1 row in set (0.00 sec)
</pre>

    <h4>(2) <a name="2">ビット演算</a></h4>
    <p>
        情報処理の分野では、馴染み深いビット演算ができます。
    </p>
    <p>
        論理和：<em>|</em>
    </p>
    <pre class=c>
mysql> select 0|0, 0|1, 1|0, 1|1;
+-----+-----+-----+-----+
| 0|0 | 0|1 | 1|0 | 1|1 |
+-----+-----+-----+-----+
|   0 |   1 |   1 |   1 | 
+-----+-----+-----+-----+
1 row in set (0.00 sec)
</pre>
    <p>
        論理積：<em>&</em>
    </p>
    <pre class=c>
mysql> select 0&0, 0&1, 1&0, 1&1;
+-----+-----+-----+-----+
| 0&0 | 0&1 | 1&0 | 1&1 |
+-----+-----+-----+-----+
|   0 |   0 |   0 |   1 | 
+-----+-----+-----+-----+
1 row in set (0.00 sec)
</pre>
    <p>
        排他的論理和：<em>^</em>
    </p>
    <pre class=c>
mysql> select 0^0, 0^1, 1^0, 1^1;
+-----+-----+-----+-----+
| 0^0 | 0^1 | 1^0 | 1^1 |
+-----+-----+-----+-----+
|   0 |   1 |   1 |   0 | 
+-----+-----+-----+-----+
1 row in set (0.00 sec)
</pre>
    <p>
        ビットシフト： <em>&lt;&lt;</em> または <em>&gt;&gt;</em>
    </p>
    <pre class=c>
mysql> select 1<<0, 1<<1, 1<<2, 1<<3;
+------+------+------+------+
| 1<<0 | 1<<1 | 1<<2 | 1<<3 |
+------+------+------+------+
|    1 |    2 |    4 |    8 | 
+------+------+------+------+
1 row in set (0.01 sec)
</pre>
    <pre class=c>
mysql> select 8>>0, 8>>1, 8>>2, 8>>3, 8>>4, 8>>5;
+------+------+------+------+------+------+
| 8>>0 | 8>>1 | 8>>2 | 8>>3 | 8>>4 | 8>>5 |
+------+------+------+------+------+------+
|    8 |    4 |    2 |    1 |    0 |    0 | 
+------+------+------+------+------+------+
1 row in set (0.00 sec)
</pre>
    <p>
        論理否定：<em>~</em> ※１６進数表記したい場合は、冒頭部に<em>"0x"</em>を付記
    </p>
    <pre class=c>
mysql> select ~0xffffffffffffffff,~0xfffffffffffffff0,~0xffffffffffffff00;
+---------------------+---------------------+---------------------+
| ~0xffffffffffffffff | ~0xfffffffffffffff0 | ~0xffffffffffffff00 |
+---------------------+---------------------+---------------------+
|                   0 |                  15 |                 255 | 
+---------------------+---------------------+---------------------+
1 row in set (0.01 sec)
</pre>
    <p>
        当然ながら、各演算を組み合わせて使用できます。
    </p>
    <pre class=c>
mysql> select 15|240, 0x0f|0xf0, (0xff&0xf0)|(0xff>>4);
+--------+-----------+-----------------------+
| 15|240 | 0x0f|0xf0 | (0xff&0xf0)|(0xff>>4) |
+--------+-----------+-----------------------+
|    255 |       255 |                   255 | 
+--------+-----------+-----------------------+
1 row in set (0.00 sec)
</pre>

    <h4>(3) <a name="3">比較演算</a></h4>
    <p>
        条件付検索（SELECT文にWHERE条件を付けた検索）のときに、すでに用いた比較演算子（<em>=,!=,<,<=,>
                ,>=</em>など）を使用できます。各演算結果は、一般的なプログラミング言語と同様、<em>真：1<em>、</em>偽：0</em>、として与えられます。
    </p>
    <pre class=c>
mysql> select 100=200, 100=100, 100!=100;
+---------+---------+----------+
| 100=200 | 100=100 | 100!=100 |
+---------+---------+----------+
|       0 |       1 |        0 | 
+---------+---------+----------+
1 row in set (0.00 sec)
</pre>
    <pre class=c>
mysql> select 100<100, 100<=100, 100>=100, 100>1000;
+---------+----------+----------+----------+
| 100<100 | 100<=100 | 100>=100 | 100>1000 |
+---------+----------+----------+----------+
|       0 |        1 |        1 |        0 | 
+---------+----------+----------+----------+
1 row in set (0.00 sec)
</pre>

    <h4>(4) <a name="4">数値関数 </a></h4>
    <p>
        基本的な数値演算の関数を使用できます。MySQLには、かなりの種類の関数が用意されています。ここでは、基本的なものとして、平方根：<em>sqrt(数値)</em>、乱数：<em>rand()</em>、べき乗：<em>pow(基数,指数)</em>、とその計算例をいくつか紹介します。
    </p>
    <pre class=c>
mysql> select sqrt(2), sqrt(3), sqrt(4);
+-----------------+-----------------+---------+
| sqrt(2)         | sqrt(3)         | sqrt(4) |
+-----------------+-----------------+---------+
| 1.4142135623731 | 1.7320508075689 |       2 | 
+-----------------+-----------------+---------+
1 row in set (0.01 sec)
</pre>
    <p>
        rand()は、実行するたびに、0 以上 1.0 未満の異なる値（乱数、浮動小数点値）を返すので、扱いには注意が必要です。
    </p>
    <pre class=c>
mysql> select rand(), rand(), rand();
+-----------------+------------------+------------------+
| rand()          | rand()           | rand()           |
+-----------------+------------------+------------------+
| 0.6156546898332 | 0.56369309086697 | 0.97150141556887 | 
+-----------------+------------------+------------------+
1 row in set (0.01 sec)
</pre>
    <p>
        関数の中には、π：<em>pi()</em>のように定数を返すものもあります。
    </p>
    <pre class=c>
mysql> select pi(), 2*pi()*10;
+----------+-----------+
| pi()     | 2*pi()*10 |
+----------+-----------+
| 3.141593 | 62.831853 | 
+----------+-----------+
1 row in set (0.00 sec)
</pre>
    <p>
        ※次の計算は、何の値を求めているでしょうか？
    </p>
    <pre class=c>
mysql> select pi()*pow(10,2), 4*pi()*pow(10,2), 4*pi()*pow(10,3)/3;
+-----------------+------------------+--------------------+
| pi()*pow(10,2)  | 4*pi()*pow(10,2) | 4*pi()*pow(10,3)/3 |
+-----------------+------------------+--------------------+
| 314.15926535898 |  1256.6370614359 |    4188.7902047864 | 
+-----------------+------------------+--------------------+
1 row in set (0.00 sec)
</pre>

    <h4>(5) <a name="5">表示形式</a></h4>
    <p>
        表示を整えるには、いくつかの方法があります。簡単な例としては、すでに紹介した、 <em>AS</em> 指定による表示名の付け替えです。
    </p>
    <pre class=c>
mysql> select 4*pi()*pow(10,2) as Square, 4*pi()*pow(10,3)/3 as Volume;
+-----------------+-----------------+
| Square          | Volume          |
+-----------------+-----------------+
| 1256.6370614359 | 4188.7902047864 | 
+-----------------+-----------------+
1 row in set (0.00 sec)
</pre>
    <p>
        数値の表示桁を整えるための関数 <em>format</em>（数値,小数部の桁数）も用意されています。 format() は、整数部を３桁ごとに区切り、小数部の桁数を制限する関数です。
    </p>
    <pre class=c>
mysql> select format(4*pi()*pow(10,3)/3, 3) as Volume;
+-----------+
| Volume    |
+-----------+
| 4,188.790 | 
+-----------+
1 row in set (0.01 sec)
</pre>

    <h4>(6) <a name="6">丸め処理</a></h4>
    <p>
        数値の端数部（小数部分）の丸め処理として、切捨て：<em>floor(数値)</em>、切り上げ：<em>ceil(数値)</em>、四捨五入：<em>round(数値)</em>、などの丸め処理ができます。使い方は、丸め処理したい値を引数として、関数に渡すだけです。処理結果が返り値として与えられます。
    </p>
    <pre class=c>
mysql> select pi(), floor(pi()), ceil(pi()), round(pi()), floor(pi()+0.5);
+----------+-------------+------------+-------------+-----------------+
| pi()     | floor(pi()) | ceil(pi()) | round(pi()) | floor(pi()+0.5) |
+----------+-------------+------------+-------------+-----------------+
| 3.141593 |           3 |          4 |           3 |               3 | 
+----------+-------------+------------+-------------+-----------------+
1 row in set (0.00 sec)
</pre>


    <h4>(7) <a name="7">基数変換</a></h4>
    <p>
        任意の値を、２進数：<em>bin(数値)</em>、８進数：<em>oct(数値)</em>、１６進数：<em>hex(数値)</em>、それぞれの基数に変換できます。また、<em>conv(変換前数値,変換前基数,変換後基数)</em>関数を用いると、任意の基数表現に変換できます。
    </p>
    <pre class=c>
mysql> select 15, bin(15), oct(15), hex(15), conv(15,10,7);
+----+---------+---------+---------+---------------+
| 15 | bin(15) | oct(15) | hex(15) | conv(15,10,7) |
+----+---------+---------+---------+---------------+
| 15 | 1111    | 17      | F       | 21            | 
+----+---------+---------+---------+---------------+
1 row in set (0.01 sec)
</pre>


    <h4>(8) <a name="8">文字列処理</a></h4>
    <p>
        MySQLでは、文字列操作の関数が用意されています。<em>upper(文字列)</em>、<em>reverse(文字列)</em>、<em>insert(文字列,位置,置換文字数,挿入文字列)</em>は、それぞれ大文字変換、左右反転、文字列挿入の関数です。
    </p>
    <pre class=c>
mysql> select upper("abcd"), reverse("abcd"), insert("abcd",2,1,"EFG");
+---------------+-----------------+--------------------------+
| upper("abcd") | reverse("abcd") | insert("abcd",2,1,"EFG") |
+---------------+-----------------+--------------------------+
| ABCD          | dcba            | aEFGcd                   | 
+---------------+-----------------+--------------------------+
1 row in set (0.00 sec)
</pre>
    <p>
        <em>right(文字列,抽出数)</em>、<em>left(文字列,抽出数)</em>、<em>concat(文字列,文字列,...,文字列)</em>は、それぞれ右側部分抽出、右側部分抽出、文字列連結の関数です。
    </p>
    <pre class=c>
mysql> select right("abcd",3), left("abcd",3), concat("ab","cd","ef");
+-----------------+----------------+------------------------+
| right("abcd",3) | left("abcd",3) | concat("ab","cd","ef") |
+-----------------+----------------+------------------------+
| bcd             | abc            | abcdef                 | 
+-----------------+----------------+------------------------+
1 row in set (0.00 sec)
</pre>
    <p>
        <em>trim（文字列）</em>は、文字列の両側にある空白を取り除く関数です。
    </p>
    <pre class=c>
mysql> select "  abc d  " as A, trim("  abc d  ") as B;
+-----------+-------+
| A         | B     |
+-----------+-------+
|   abc d   | abc d | 
+-----------+-------+
1 row in set (0.00 sec)
</pre>
    <p>
        これらの文字列を処理する関数群は、フォームなどに入力された値（文字列）を処理しやすい形に加工するために用います。
    </p>


    <h4>(9) <a name="9">日時処理</a></h4>
    <p>
        データベースでは、日付や時間を値として利用する場合が多いです。その書式や形式変換などのために、様々な関数が用意されています。ここでは基本的な現在日時取得：<em>now()</em>、日付取得：<em>curdate()</em>、現在時刻取得：<em>curtime()</em>、のための関数を紹介します。各関数の返り値に<em>"+0"</em>を付記（例："now()+0"）すると、その値は数値として扱われます。これは、他の関数でも同様です。
    </p>
    <pre class=c>
mysql> select now(), curdate(), curtime(), now()+0;
+---------------------+------------+-----------+-----------------------+
| now()               | curdate()  | curtime() | now()+0               |
+---------------------+------------+-----------+-----------------------+
| 2010-11-10 09:13:43 | 2010-11-10 | 09:13:43  | 20101110091343.000000 | 
+---------------------+------------+-----------+-----------------------+
1 row in set (0.00 sec)
</pre>
    <p>
        また、日時の形式を変換する関数として、年表示：<em>year(日付文字列)</em>、月表示：<em>month(日付文字列)</em>、日表示：<em>day(日付文字列)</em>があります。
    </p>
    <pre class=c>
mysql> select curdate(),year(curdate()), month(curdate()), day(curdate());
+------------+-----------------+------------------+----------------+
| curdate()  | year(curdate()) | month(curdate()) | day(curdate()) |
+------------+-----------------+------------------+----------------+
| 2010-11-10 |            2010 |               11 |             10 | 
+------------+-----------------+------------------+----------------+
1 row in set (0.00 sec)
</pre>
    <p>
        他にも、月と曜日の英語表記関数：<em>monthname(日付文字列)</em>、<em>dayname(日付文字列)</em>
        、曜日を数値に置き換える関数：<em>weekday(日付文字列)</em>を利用できます。特に、weekday()は、<em>月曜をゼロ（0）</em>とし、火（1）、水（2）、...、日（6）の順に数値を割り当て、その数値を返す点に注意が必要です。
    </p>
    <pre class=c>
mysql> select monthname(curdate()), dayname(curdate()), weekday(curdate());
+----------------------+--------------------+--------------------+
| monthname(curdate()) | dayname(curdate()) | weekday(curdate()) |
+----------------------+--------------------+--------------------+
| November             | Wednesday          |                  2 | 
+----------------------+--------------------+--------------------+
1 row in set (0.00 sec)
</pre>
    <p>
        これらの日時取得の関数は、アクセスログの作成などに利用できます。
    </p>



</body>

</html>